<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/fontawesome-all.min.css">
    <link rel="stylesheet" href="css/MarkerCluster.Default.css">
    <link rel="stylesheet" href="css/leaflet-search.css">
    <link rel="stylesheet" href="css/filter.css">
    <link rel="stylesheet" href="css/leaflet-measure.css">
    <link rel="stylesheet" href="css/leaflet-sidebar.css">
    <link rel="stylesheet" href="css/leaflet-geoman.css">
    <link rel="stylesheet" href="css/w3.css">
    <style>
       #map {
            width: 100vw;
            height: 100vh;
        }

        .leaflet-popup-content {
            width: 300px;
            /*height: 300px;
            overflow-y: scroll;*/
        }

        table,
        th {
            border: 2px solid grey;
        }

        /* Fixing width of first
            column of each row*/
        td:nth-child(1) {
            border: 2px solid grey;
            width: 10%;
        }

        /* Fixing width of second
            column of each row*/
        td:nth-child(2) {
            border: 2px solid grey;
            width: 30%;
        }

        /* Fixing width of third
            column of each row*/
        td:nth-child(3) {
            border: 2px solid grey;
            width: 60%;
        }

        /*adding row numbers through css*/
        .w3-table-all {
            counter-reset: serial-number;
            /* Set the serial number counter to 0 */
        }

        .w3-table-all td:first-child:before {
            counter-increment: serial-number;
            /* Increment the serial number counter */
            content: counter(serial-number);
            /* Display the counter */
        }
    </style>
    <title>Staff Map</title>

    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/leaflet-geoman.min.js"></script>
    <script src="js/turf.min.js"></script>
    <script src="js/multiselect-dropdown.js"></script>
    <script src="js/leaflet-sidebar.js"></script>
    <script src="js/leaflet-svg-shape-markers.min.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/leaflet-measure.js"></script>
    <script src="js/leaflet.markercluster.js"></script>
    <script src="js/leaflet-search.js"></script>
    <script src="data/all_residence_1.js"></script>
    <script src="data/cluster_residence_2.js"></script>
    <script src="data/search_residence_3.js"></script>
</head>

<body>
    <div id="map">
        <div id="sidebar" class="sidebar collapsed">
            <!-- Nav tabs -->
            <div class="sidebar-tabs">
                <ul role="tablist">
                    <li><a href="#shiftslider" role="tab"><i class="fa fa-list-ul"></i></a></li>
                    <li><a href="#filter" role="tab"><i class="fa fa-filter"></i></a></li>
                    <li><a href="#select" role="tab"><i class="fa fa-users"></i></a>
                    </li>
                </ul>

                <ul role="tablist">
                    <li><a href="#settings" role="tab"><i class="fa fa-cog"></i></a></li>
                </ul>
            </div>

            <!-- Tab panes -->
            <div class="sidebar-content" id="sidebar-content">
                <div class="sidebar-pane" id="shiftslider">
                    <h1 class="sidebar-header" style="font-weight:bold">
                        Shift Slider
                        <span class="sidebar-close"><i class="fa fa-caret-right"></i></span>
                    </h1>
                </div>

                <div class="sidebar-pane" id="filter">
                    <h1 class="sidebar-header" style="font-weight:bold">
                        Layer Switch & Filter
                        <span class="sidebar-close"><i class="fa fa-caret-right"></i></span>
                    </h1><br>
                </div>

                <div class="sidebar-pane" id="select">
                    <h1 class="sidebar-header" style="font-weight:bold">
                        Selected Staff
                        <span class="sidebar-close"><i class="fa fa-caret-right"></i></span>
                    </h1>
                    <p>
                    <table id="table" class="w3-table-all" style="width:100%; border-style:solid;">
                        <tr>
                            <th width="10%" style="font-size:14px;">#</th>
                            <th width="30%" style="font-size:14px;">Staff No. </th>
                            <th width="60%" style="font-size:14px;">Name </th>
                        </tr>
                    </table>
                    </p>
                </div>

                <div class="sidebar-pane" id="settings">
                    <h1 class="sidebar-header" style="font-weight:bold">
                        Settings
                        <span class="sidebar-close"><i class="fa fa-caret-right"></i></span>
                    </h1>
                </div>
            </div>
        </div>
        <script>
            var highlightLayer;
            function highlightFeature(e) {
                highlightLayer = e.target;

                if (e.target.feature.geometry.type === 'LineString') {
                    highlightLayer.setStyle({
                        color: '#ffff00',
                    });
                } else {
                    highlightLayer.setStyle({
                        fillColor: '#ffff00',
                        fillOpacity: 1
                    });
                }
                highlightLayer.openPopup();
            }
            var map = L.map('map', {
                zoomControl: false
            }).fitBounds([[-3.5428957898144042, 30.423881770612397], [2.759856437494573, 41.7898658501702]]);
            var hash = new L.Hash(map);
            map.attributionControl.setPrefix('<a href="https://github.com/DNSQi" target="_blank">DNSQi</a> &middot; <a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
            var autolinker = new Autolinker({ truncate: { length: 30, location: 'smart' } }); 

            var refresh = L.control({
                position: 'topleft'
            });
            refresh.onAdd = function (map) {
                var div = L.DomUtil.create('div');
                div.innerHTML =
                    `<input type="button" id="refresh" 
                        onclick=location.reload(true) value="Refresh Map">
                    </input>`;
                return div;
            };
            refresh.addTo(map);

            var zoomControl = L.control.zoom({
                position: "topleft",
                maxZoom: 28,
                minZoom: 1
            }).addTo(map);

            var bounds_group = new L.featureGroup([]);
            function setBounds() {
            }
            map.createPane('pane_OpenStreetMap_0');
            map.getPane('pane_OpenStreetMap_0').style.zIndex = 400;
            var layer_OpenStreetMap_0 = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                pane: 'pane_OpenStreetMap_0',
                opacity: 1.0,
                attribution: '',
                minZoom: 1,
                maxZoom: 28,
                minNativeZoom: 0,
                maxNativeZoom: 19
            });
            layer_OpenStreetMap_0;
            map.addLayer(layer_OpenStreetMap_0);
            function pop_all_residence_1(feature, layer) {
                layer.on({
                    mouseout: function (e) {
                        for (i in e.target._eventParents) {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                        if (typeof layer.closePopup == 'function') {
                            layer.closePopup();
                        } else {
                            layer.eachLayer(function (feature) {
                                feature.closePopup()
                            });
                        }
                    },
                    mouseover: highlightFeature,
                });
                var popupContent = '<div style="font-size:16px; font-family: Arial; width:230;">\
                <table style="font-size:16px; border:none;">\
                    <tr>\
                        <td style="border:none;">\
                            <img src="file:///C:/qgis/qgis2web_2022_10_15-08_21_57_184937/images/portrait_placeholder.png" width=85 />\
                        </td>\
                        <td style="border:none;">\
                            <span style="font-weight:bold">' + (feature.properties['EK'] !== null ? autolinker.link(feature.properties['EK'].toLocaleString()) : '') + '</br>\
                                ' + (feature.properties['Name'] !== null ? autolinker.link(feature.properties['Name'].toLocaleString()) : '') + '</span>\
                        </td>\
                    </tr>\
                </table>\
                <table class="w3-table-all" width="100%" style="font-size:12px" border="1">\
                    <tr>\
                        <th scope="row" width="1%">Username</th>\
                        <td>' + (feature.properties['Username'] !== null ? autolinker.link(feature.properties['Username'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Office</th>\
                        <td>' + (feature.properties['Office'] !== null ? autolinker.link(feature.properties['Office'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Route</th>\
                        <td>' + (feature.properties['Route'] !== null ? autolinker.link(feature.properties['Route'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">SubRoute</th>\
                        <td>' + (feature.properties['SubRoute'] !== null ? autolinker.link(feature.properties['SubRoute'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Residence</th>\
                        <td>' + (feature.properties['Residence'] !== null ? autolinker.link(feature.properties['Residence'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Phone</th>\
                        <td>' + (feature.properties['Phone'] !== null ? autolinker.link(feature.properties['Phone'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Work</th>\
                        <td>' + (feature.properties['Work'] !== null ? autolinker.link(feature.properties['Work'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
                layer.bindPopup(popupContent, {
                    maxHeight: 400,
                    autoPan: false
                });
            }

            function style_all_residence_1_0(feature) {
                switch (String(feature.properties['Office'])) {
                    case 'OnSite':
                        return {
                            pane: 'pane_all_residence_1',
                            shape: 'triangle',
                            radius: 8.0,
                            opacity: 1,
                            color: 'rgba(0,0,0,1.0)',
                            dashArray: '',
                            lineCap: 'butt',
                            lineJoin: 'miter',
                            weight: 2.0,
                            fill: true,
                            fillOpacity: 1,
                            fillColor: 'rgba(31,120,180,1.0)',
                            interactive: true,
                        }
                        break;
                    case 'OffSite':
                        return {
                            pane: 'pane_all_residence_1',
                            shape: 'triangle',
                            radius: 8.0,
                            opacity: 1,
                            color: 'rgba(0,0,0,1.0)',
                            dashArray: '',
                            lineCap: 'butt',
                            lineJoin: 'miter',
                            weight: 2.0,
                            fill: true,
                            fillOpacity: 1,
                            fillColor: 'rgba(31,120,180,1.0)',
                            interactive: true,
                        }
                        break;
                }
            }
            map.createPane('pane_all_residence_1');
            map.getPane('pane_all_residence_1').style.zIndex = 421;
            map.getPane('pane_all_residence_1').style['mix-blend-mode'] = 'normal';
            var layer_all_residence_1 = new L.geoJson(json_all_residence_1, {
                attribution: '',
                interactive: true,
                dataVar: 'json_all_residence_1',
                layerName: 'layer_all_residence_1',
                pane: 'pane_all_residence_1',
                onEachFeature: pop_all_residence_1,
                pointToLayer: function (feature, latlng) {
                    var context = {
                        feature: feature,
                        variables: {}
                    };
                    return L.shapeMarker(latlng, style_all_residence_1_0(feature));
                },
            });
            bounds_group.addLayer(layer_all_residence_1);
            //map.addLayer(layer_all_residence_1);
            function pop_cluster_residence_2(feature, layer) {
                layer.on({
                    mouseout: function (e) {
                        for (i in e.target._eventParents) {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                        if (typeof layer.closePopup == 'function') {
                            layer.closePopup();
                        } else {
                            layer.eachLayer(function (feature) {
                                feature.closePopup()
                            });
                        }
                    },
                    mouseover: highlightFeature,
                });
                var popupContent = '<div style="font-size:16px; font-family: Arial; width:230;">\
                <table style="font-size:16px; border:none;">\
                    <tr>\
                        <td style="border:none;">\
                            <img src="file:///C:/qgis/qgis2web_2022_10_15-08_21_57_184937/images/portrait_placeholder.png" width=85 />\
                        </td>\
                        <td style="border:none;">\
                            <span style="font-weight:bold">' + (feature.properties['EK'] !== null ? autolinker.link(feature.properties['EK'].toLocaleString()) : '') + '</br>\
                                ' + (feature.properties['Name'] !== null ? autolinker.link(feature.properties['Name'].toLocaleString()) : '') + '</span>\
                        </td>\
                    </tr>\
                </table>\
                <table class="w3-table-all" width="100%" style="font-size:12px" border="1">\
                    <tr>\
                        <th scope="row" width="1%">Username</th>\
                        <td>' + (feature.properties['Username'] !== null ? autolinker.link(feature.properties['Username'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Office</th>\
                        <td>' + (feature.properties['Office'] !== null ? autolinker.link(feature.properties['Office'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Route</th>\
                        <td>' + (feature.properties['Route'] !== null ? autolinker.link(feature.properties['Route'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">SubRoute</th>\
                        <td>' + (feature.properties['SubRoute'] !== null ? autolinker.link(feature.properties['SubRoute'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Residence</th>\
                        <td>' + (feature.properties['Residence'] !== null ? autolinker.link(feature.properties['Residence'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Phone</th>\
                        <td>' + (feature.properties['Phone'] !== null ? autolinker.link(feature.properties['Phone'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Work</th>\
                        <td>' + (feature.properties['Work'] !== null ? autolinker.link(feature.properties['Work'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
                layer.bindPopup(popupContent, {
                    maxHeight: 400,
                    autoPan: false
                });
            }

            function style_cluster_residence_2_0(feature) {
                switch (String(feature.properties['Office'])) {
                    case 'OnSite':
                        return {
                            pane: 'pane_cluster_residence_2',
                            shape: 'triangle',
                            radius: 8.0,
                            opacity: 1,
                            color: 'rgba(0,0,0,1.0)',
                            dashArray: '',
                            lineCap: 'butt',
                            lineJoin: 'miter',
                            weight: 2.0,
                            fill: true,
                            fillOpacity: 1,
                            fillColor: 'rgba(31,120,180,1.0)',
                            interactive: true,
                        }
                        break;
                    case 'OffSite':
                        return {
                            pane: 'pane_cluster_residence_2',
                            shape: 'triangle',
                            radius: 8.0,
                            opacity: 1,
                            color: 'rgba(0,0,0,1.0)',
                            dashArray: '',
                            lineCap: 'butt',
                            lineJoin: 'miter',
                            weight: 2.0,
                            fill: true,
                            fillOpacity: 1,
                            fillColor: 'rgba(31,120,180,1.0)',
                            interactive: true,
                        }
                        break;
                }
            }
            map.createPane('pane_cluster_residence_2');
            map.getPane('pane_cluster_residence_2').style.zIndex = 422;
            map.getPane('pane_cluster_residence_2').style['mix-blend-mode'] = 'normal';
            var layer_cluster_residence_2 = new L.geoJson(json_cluster_residence_2, {
                attribution: '',
                interactive: true,
                dataVar: 'json_cluster_residence_2',
                layerName: 'layer_cluster_residence_2',
                pane: 'pane_cluster_residence_2',
                onEachFeature: pop_cluster_residence_2,
                pointToLayer: function (feature, latlng) {
                    var context = {
                        feature: feature,
                        variables: {}
                    };
                    return L.shapeMarker(latlng, style_cluster_residence_2_0(feature));
                },
            });
            var cluster_cluster_residence_2 = new L.MarkerClusterGroup({
                showCoverageOnHover: false,
                spiderfyOnMaxZoom: false,
                disableClusteringAtZoom: 16,
                spiderfyDistanceMultiplier: 2
            });
            cluster_cluster_residence_2.addLayer(layer_cluster_residence_2);

            bounds_group.addLayer(layer_cluster_residence_2);
            cluster_cluster_residence_2.addTo(map);
            function pop_search_residence_3(feature, layer) {
                layer.on({
                    mouseout: function (e) {
                        for (i in e.target._eventParents) {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                        if (typeof layer.closePopup == 'function') {
                            layer.closePopup();
                        } else {
                            layer.eachLayer(function (feature) {
                                feature.closePopup()
                            });
                        }
                    },
                    mouseover: highlightFeature,
                });
                var popupContent = '<table></table>';
                layer.bindPopup(popupContent, { maxHeight: 400 });
            }

            function style_search_residence_3_0() {
                return {
                    fill: false,
                    stroke: false,
                    interactive: false
                }
            }
            map.createPane('pane_search_residence_3');
            map.getPane('pane_search_residence_3').style.zIndex = 403;
            map.getPane('pane_search_residence_3').style['mix-blend-mode'] = 'normal';
            var layer_search_residence_3 = new L.geoJson(json_search_residence_3, {
                attribution: '',
                interactive: false,
                dataVar: 'json_search_residence_3',
                layerName: 'layer_search_residence_3',
                pane: 'pane_search_residence_3',
                onEachFeature: pop_search_residence_3,
                pointToLayer: function (feature, latlng) {
                    var context = {
                        feature: feature,
                        variables: {}
                    };
                    return L.circleMarker(latlng, style_search_residence_3_0(feature));
                },
            });
            bounds_group.addLayer(layer_search_residence_3);

            var baseMaps = {
                '<span style="font-size: 15px; font-weight: bold;" onclick="myFunction1()">Un-Clustered Residences</span>': layer_all_residence_1,
                '<span style="font-size: 15px; font-weight: bold;" onclick="myFunction()">Clustered Residences</span>': cluster_cluster_residence_2
            };
            L.control.layers(baseMaps, {}).addTo(map);

            var layer = L.control.layers(baseMaps, {}, { collapsed: false }).addTo(map);
            var htmlObject = layer.getContainer();
            var a = document.getElementById('filter')
            function setParent(el, newParent) {
                newParent.appendChild(el);
            }
            setParent(htmlObject, a);

            setBounds();

            map.addControl(new L.Control.Search({
                layer: layer_search_residence_3,
                initial: false,
                hideMarkerOnCollapse: true,
                collapsed: true,
                textPlaceholder: 'Enter EK or Name or Username',
                propertyName: 'EkUserName'
            }));
            document.getElementsByClassName('search-button')[0].className +=
                ' fa fa-search';
            var mapDiv = document.getElementById('sidebar');
            var row = document.createElement('div');
            row.className = "row";
            row.id = "all";
            row.style.height = "100%";
            var col1 = document.createElement('div');
            col1.className = "col9";
            col1.id = "mapWindow";
            col1.style.height = "99%";
            col1.style.width = "80%";
            col1.style.display = "inline-block";
            var col2 = document.createElement('div');
            col2.className = "col3";
            col2.id = "menu";
            col2.style.display = "inline-block";
            mapDiv.parentNode.insertBefore(row, mapDiv);
            document.getElementById("all").appendChild(col1);
            document.getElementById("all").appendChild(col2);
            col1.appendChild(mapDiv)
            var Filters = { "Office": "str", "Manager": "str", "TeamLead": "str", "Route": "str" };
            function filterFunc() {
                map.eachLayer(function (lyr) {
                    if ("options" in lyr && "dataVar" in lyr["options"]) {
                        features = this[lyr["options"]["dataVar"]].features.slice(0);
                        try {
                            for (key in Filters) {
                                keyS = key.replace(/[^a-zA-Z0-9_]/g, "")
                                if (Filters[key] == "str" || Filters[key] == "bool") {
                                    var selection = [];
                                    var options = document.getElementById("sel_" + keyS).options
                                    for (var i = 0; i < options.length; i++) {
                                        if (options[i].selected) selection.push(options[i].value);
                                    }
                                    try {
                                        if (key in features[0].properties) {
                                            for (i = features.length - 1;
                                                i >= 0; --i) {
                                                if (selection.indexOf(
                                                    features[i].properties[key]) < 0
                                                    && selection.length > 0) {
                                                    features.splice(i, 1);
                                                }
                                            }
                                        }
                                    } catch (err) {
                                    }
                                }
                                if (Filters[key] == "int") {
                                    sliderVals = document.getElementById(
                                        "div_" + keyS).noUiSlider.get();
                                    try {
                                        if (key in features[0].properties) {
                                            for (i = features.length - 1; i >= 0; --i) {
                                                if (parseInt(features[i].properties[key])
                                                    < sliderVals[0]
                                                    || parseInt(features[i].properties[key])
                                                    > sliderVals[1]) {
                                                    features.splice(i, 1);
                                                }
                                            }
                                        }
                                    } catch (err) {
                                    }
                                }
                                if (Filters[key] == "real") {
                                    sliderVals = document.getElementById(
                                        "div_" + keyS).noUiSlider.get();
                                    try {
                                        if (key in features[0].properties) {
                                            for (i = features.length - 1; i >= 0; --i) {
                                                if (features[i].properties[key]
                                                    < sliderVals[0]
                                                    || features[i].properties[key]
                                                    > sliderVals[1]) {
                                                    features.splice(i, 1);
                                                }
                                            }
                                        }
                                    } catch (err) {
                                    }
                                }
                                if (Filters[key] == "date"
                                    || Filters[key] == "datetime"
                                    || Filters[key] == "time") {
                                    try {
                                        if (key in features[0].properties) {
                                            HTMLkey = key.replace(/[&\/\\#,+()$~%.'":*?<>{} ]/g, '');
                                            startdate = document.getElementById("dat_" +
                                                HTMLkey + "_date1").value.replace(" ", "T");
                                            enddate = document.getElementById("dat_" +
                                                HTMLkey + "_date2").value.replace(" ", "T");
                                            for (i = features.length - 1; i >= 0; --i) {
                                                if (features[i].properties[key] < startdate
                                                    || features[i].properties[key] > enddate) {
                                                    features.splice(i, 1);
                                                }
                                            }
                                        }
                                    } catch (err) {
                                    }
                                }
                            }
                        } catch (err) {
                        }
                        this[lyr["options"]["layerName"]].clearLayers();
                        this[lyr["options"]["layerName"]].addData(features);
                    }
                })
            }

            document.getElementById("filter").appendChild(
                document.createElement("div"));
            var div_Office = document.createElement('div');
            div_Office.id = "div_Office";
            div_Office.className = "filterselect";
            document.getElementById("filter").appendChild(div_Office);
            var lab_Office = document.createElement('div');
            lab_Office.innerHTML = '<br><br><br><span style="font-size: 15px; font-weight: bold;">Office</span>';
            lab_Office.className = 'filterlabel';
            div_Office.appendChild(lab_Office);
            sel_Office = document.createElement('select');
            sel_Office.setAttribute("multiselect-search", "true");
            sel_Office.multiple = true;
            sel_Office.size = 1;
            sel_Office.id = "sel_Office";
            sel_Office.onchange = function () { filterFunc() };
            Office_options_str = '<option value="OnSite">OnSite</option>';
            Office_options_str += '<option value="OffSite">OffSite</option>';
            sel_Office.innerHTML = Office_options_str;
            div_Office.appendChild(sel_Office);
            var reset_Office = document.createElement('div');
            reset_Office.innerHTML = '<button style="float: right;">Clear Filter</button>';
            reset_Office.className = 'resetfilter';
            reset_Office.onclick = function () {
                var options = document.getElementById("sel_Office").options;
                for (var i = 0; i < options.length; i++) {
                    options[i].selected = false;
                }
                filterFunc();
            };
            div_Office.appendChild(reset_Office);

            document.getElementById("filter").appendChild(
                document.createElement("div"));
            var div_Manager = document.createElement('div');
            div_Manager.id = "div_Manager";
            div_Manager.className = "filterselect";
            document.getElementById("filter").appendChild(div_Manager);
            var lab_Manager = document.createElement('div');
            lab_Manager.innerHTML = '<br><span style="font-size: 15px; font-weight: bold;">Manager</span>';
            lab_Manager.className = 'filterlabel';
            div_Manager.appendChild(lab_Manager);
            sel_Manager = document.createElement('select');
            sel_Manager.setAttribute("multiselect-search", "true");
            sel_Manager.multiple = true;
            sel_Manager.size = 8;
            sel_Manager.id = "sel_Manager";
            sel_Manager.onchange = function () { filterFunc() };
            Manager_options_str = '<option value="John Doe">John Doe</option>';
            Manager_options_str += '<option value="Jane Doe">Jane Doe</option>';
            sel_Manager.innerHTML = Manager_options_str;
            div_Manager.appendChild(sel_Manager);
            var reset_Manager = document.createElement('div');
            reset_Manager.innerHTML = '<button style="float: right;">Clear Filter</button>';
            reset_Manager.className = 'resetfilter';
            reset_Manager.onclick = function () {
                var options = document.getElementById("sel_Manager").options;
                for (var i = 0; i < options.length; i++) {
                    options[i].selected = false;
                }
                filterFunc();
            };
            div_Manager.appendChild(reset_Manager);

            document.getElementById("filter").appendChild(
                document.createElement("div"));
            var div_TeamLead = document.createElement('div');
            div_TeamLead.id = "div_TeamLead";
            div_TeamLead.className = "filterselect";
            document.getElementById("filter").appendChild(div_TeamLead);
            var lab_TeamLead = document.createElement('div');
            lab_TeamLead.innerHTML = '<br><span style="font-size: 15px; font-weight: bold;">TeamLead</span>';
            lab_TeamLead.className = 'filterlabel';
            div_TeamLead.appendChild(lab_TeamLead);
            var reset_TeamLead = document.createElement('div');
            sel_TeamLead = document.createElement('select');
            sel_TeamLead.setAttribute("multiselect-search", "true");
            sel_TeamLead.multiple = true;
            sel_TeamLead.size = 8;
            sel_TeamLead.id = "sel_TeamLead";
            sel_TeamLead.onchange = function () { filterFunc() };
            TeamLead_options_str = '<option value="John Doe">John Doe</option>';
            TeamLead_options_str += '<option value="Jane Doe">Jane Doe</option>';
            sel_TeamLead.innerHTML = TeamLead_options_str;
            div_TeamLead.appendChild(sel_TeamLead);
            reset_TeamLead.innerHTML = '<button style="float: right;">Clear Filter</button>';
            reset_TeamLead.className = 'resetfilter';
            reset_TeamLead.onclick = function () {
                var options = document.getElementById("sel_TeamLead").options;
                for (var i = 0; i < options.length; i++) {
                    options[i].selected = false;
                }
                filterFunc();
            };
            div_TeamLead.appendChild(reset_TeamLead);

            document.getElementById("filter").appendChild(
                document.createElement("div"));
            var div_Route = document.createElement('div');
            div_Route.id = "div_Route";
            div_Route.className = "filterselect";
            document.getElementById("filter").appendChild(div_Route);
            var lab_Route = document.createElement('div');
            lab_Route.innerHTML = '<br><span style="font-size: 15px; font-weight: bold;">Route</span>';
            lab_Route.className = 'filterlabel';
            div_Route.appendChild(lab_Route);
            sel_Route = document.createElement('select');
            sel_Route.setAttribute("multiselect-search", "true");
            sel_Route.multiple = true;
            //sel_Route.size = 8;
            sel_Route.id = "sel_Route";
            sel_Route.onchange = function () { filterFunc() };
            Route_options_str = '<option value="Highway">Highway</option>';
            Route_options_str += '<option value="Expressway">Expressway</option>';
            sel_Route.innerHTML = Route_options_str;
            div_Route.appendChild(sel_Route);
            var reset_Route = document.createElement('div');
            reset_Route.innerHTML = '<button style="float: right;">Clear Filter</button>';
            reset_Route.className = 'resetfilter';
            reset_Route.onclick = function () {
                var options = document.getElementById("sel_Route").options;
                for (var i = 0; i < options.length; i++) {
                    options[i].selected = false;
                }
                filterFunc();
            };
            div_Route.appendChild(reset_Route);

            // add Leaflet-Sidebar controls with some options to the map 
            var sidebar = L.control.sidebar('sidebar', {
                position: 'right'
            }).addTo(map);

            var div = L.DomUtil.get('sidebar');
            L.DomEvent.disableClickPropagation(div);
            L.DomEvent.disableScrollPropagation(div);

            // add Leaflet-Geoman controls with some options to the map  
            map.pm.addControls({
                position: 'topleft',
                drawMarker: false,
                drawCircle: true,
                drawText: false,
                drawCircleMarker: false,
                drawPolyline: false,
                editMode: false,
                cutPolygon: false,
                rotateMode: false,
            });

            L.Polygon.include({
                contains: function (latLng) {
                    return turf.inside(new L.Marker(latLng).toGeoJSON(), this.toGeoJSON());
                }
            });
            L.Rectangle.include({
                contains: function (latLng) {
                    return this.getBounds().contains(latLng);
                }
            });
            L.Circle.include({
                contains: function (latLng) {
                    return this.getLatLng().distanceTo(latLng) < this.getRadius();
                }
            });

            map.on('pm:create', function (e) {
                layer_all_residence_1.eachLayer(function (marker) {
                    if (!e.layer.contains(marker.getLatLng())) {
                        marker.remove();
                    }
                });
            });

            map.on('pm:drawend', e => {
                e.target.eachLayer(layer => {
                    if (layer.options.shape) {
                        document.getElementsByClassName("leaflet-interactive")[0].addEventListener("mouseover", function () {
                            var demo2 =
                                "<table style=width:\'100%\' border=\'1\'>\n" +
                                "<tr>\n" +
                                "<td></td>\n" +
                                "<td>" + layer.feature.properties.EK + "</td>\n" +
                                "<td>" + layer.feature.properties.Name + "</td>\n" +
                                "</tr>\n" +
                                "</table>";
                            for (var i = 0; i < demo2.length; i++) {
                                if (demo2 !== 0) {
                                    return function () {
                                        (document.querySelector("#sidebar #sidebar-content #select #table").innerHTML += demo2);
                                    }
                                }
                            }
                        }(), {
                            once: true
                        });
                    }
                });
            });

            map.on('pm:drawend', e => {
                e.target.on('click', function () {
                    toggleSidebar();
                });
                var sidebarDiv = document.getElementById('sidebar');
                toggleSidebar = function () {
                    if (hasClass(sidebarDiv, 'collapsed')) {
                        sidebar.open('select');
                    } else {
                        sidebar.close();
                    }
                }

                function hasClass(element, cls) {
                    return (' ' + element.className + ' ').indexOf(' ' + cls + ' ') > -1;
                };
            });
            function toggleFunction(bool) {
                alert(bool)
            }

            var measureControl = new L.Control.Measure({
                position: 'topleft',
                primaryLengthUnit: 'meters',
                secondaryLengthUnit: 'kilometers',
                primaryAreaUnit: 'sqmeters',
                secondaryAreaUnit: 'hectares'
            });
            measureControl.addTo(map);
            document.getElementsByClassName('leaflet-control-measure-toggle')[0]
                .innerHTML = '';
            document.getElementsByClassName('leaflet-control-measure-toggle')[0]
                .className += ' fas fa-ruler';
        </script>
</body>

</html>